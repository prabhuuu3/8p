CREATE TABLE PUBLISHER(NAME VARCHAR(18) PRIMARY KEY, ADDRESS VARCHAR(10), PHONE VARCHAR(10));
CREATE TABLE BOOK(BOOK_ID INT PRIMARY KEY, TITLE VARCHAR(20), PUBLISHER_NAME VARCHAR(20), FOREIGN KEY(PUBLISHER_NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE, PUB_YEAR INT(4));
CREATE TABLE BOOK_AUTHORS(BOOK_ID INT, AUTHOR_NAME VARCHAR(20), FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, PRIMARY KEY(BOOK_ID));
CREATE TABLE LIBRARY_BRANCH(BRANCH_ID INT PRIMARY KEY, BRANCH_NAME VARCHAR(18), ADDRESS VARCHAR(15));
CREATE TABLE BOOK_COPIES(BOOK_ID INT, BRANCH_ID INT, NO_OF_COPIES INT, PRIMARY KEY(BOOK_ID, BRANCH_ID), FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, FOREIGN KEY(BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE);
CREATE TABLE BOOK_LENDING (BOOK_ID INT, BRANCH_ID INT, CARD_NO INT, DATE_OUT DATE, DUE_DATE DATE, PRIMARY KEY(BOOK_ID, BRANCH_ID, CARD_NO), FOREIGN KEY(BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, FOREIGN KEY(BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE);

INSERT INTO PUBLISHER VALUES('PEARSON','BANGALORE','9875462530'), ('MCGRAW','NEWDELHI','7845691234'), ('SAPNA','BANGALORE','7845963210');

INSERT INTO BOOK VALUES(1111,'SE','PEARSON',2005), (2222,'DBMS','MCGRAW',2004), (3333,'ANOTOMY','PEARSON',2010), (4444,'ENCYCLOPEDIA','SAPNA',2010);

INSERT INTO BOOK_AUTHORS VALUES(1111,'SOMMERVILLE'), (2222,'NAVATHE'), (3333,'HENRY GRAY'), (4444,'THOMAS');

INSERT INTO LIBRARY_BRANCH VALUES(11,'CENTRAL TECHNICAL','MG ROAD'), (22,'MEDICAL','BH ROAD'), (33,'CHILDREN','SS PURAM'), (44,'SECRETARIAT','SIRAGATE'), (55,'GENERAL','JAYANAGAR');

INSERT INTO BOOK_COPIES (BOOK_ID, BRANCH_ID, NO_OF_COPIES) VALUES (1, 1, 10);

INSERT INTO BOOK_LENDING (BOOK_ID, BRANCH_ID, CARD_NO, DATE_OUT, DUE_DATE) VALUES (1, 1, 12345, '2021-01-01', '2021-01-15');



SELECT LB.BRANCH_NAME, B.BOOK_ID, TITLE, PUBLISHER_NAME, AUTHOR_NAME, NO_OF_COPIES FROM BOOK B, BOOK_AUTHORS BA, BOOK_COPIES BC, LIBRARY_BRANCH LB WHERE B.BOOK_ID = BA.BOOK_ID AND BA.BOOK_ID = BC.BOOK_ID AND BC.BRANCH_ID = LB.BRANCH_ID GROUP BY LB.BRANCH_NAME, B.BOOK_ID, TITLE, PUBLISHER_NAME, AUTHOR_NAME, NO_OF_COPIES;
SELECT CARD_NO FROM BOOK_LENDING WHERE DATE_OUT BETWEEN '01-JAN-2017' AND '30-JUN-2017' GROUP BY CARD_NO HAVING COUNT(*) > 3;
DELETE FROM BOOK WHERE BOOK_ID = '3333';
SELECT BOOK_ID, TITLE, PUBLISHER_NAME, PUB_YEAR FROM BOOK GROUP BY PUB_YEAR, BOOK_ID, TITLE, PUBLISHER_NAME;
CREATE VIEW BOOKS_AVAILABLE AS SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES FROM LIBRARY_BRANCH L, BOOK B, BOOK_COPIES C WHERE B.BOOK_ID = C.BOOK_ID AND L.BRANCH_ID=C.BRANCH_ID;
